<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Emerg√™ncias - Prefeitura de Ourinhos</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        
        body {
            background: #f8f9fa;
            color: #333;
            line-height: 1.6;
            min-height: 100vh;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 1.2rem 0;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo-badge {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: #1e3c72;
            font-size: 0.8rem;
            text-align: center;
            line-height: 1.1;
            padding: 5px;
        }
        
        .logo-text {
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .municipio {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 2px;
        }
        
        .main-content {
            padding: 2rem 0;
            min-height: calc(100vh - 200px);
        }
        
        .welcome-card {
            background: white;
            border-radius: 12px;
            padding: 3rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            max-width: 600px;
            width: 100%;
            margin: 0 auto 2.5rem;
            text-align: center;
        }
        
        .welcome-card h1 {
            color: #1e3c72;
            font-size: 2.2rem;
            margin-bottom: 1rem;
            font-weight: 600;
        }
        
        .welcome-card p {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.8;
        }
        
        .button-container {
            display: flex;
            flex-wrap: wrap;
            gap: 25px;
            justify-content: center;
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
        }
        
        .btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 30px 25px;
            border: none;
            border-radius: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            max-width: 250px;
            text-decoration: none;
            color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .btn-icon {
            font-size: 2.2rem;
            margin-bottom: 12px;
            opacity: 0.9;
        }
        
        .btn-report {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }
        
        .btn-report:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(231, 76, 60, 0.25);
        }
        
        .btn-login {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }
        
        .btn-login:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(44, 62, 80, 0.25);
        }
        
        .form-container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            max-width: 600px;
            margin: 0 auto;
        }
        
        .form-title {
            color: #1e3c72;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #1e3c72;
        }
        
        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .emergency-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 0.5rem;
        }
        
        .level-option {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .level-option.selected {
            border-color: #e74c3c;
            background: #ffeaea;
        }
        
        .level-3 { border-left: 4px solid #e74c3c; }
        .level-2 { border-left: 4px solid #f39c12; }
        .level-1 { border-left: 4px solid #f1c40f; }
        .level-0 { border-left: 4px solid #27ae60; }
        
        .level-number {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .level-desc {
            font-size: 0.8rem;
            color: #666;
        }
        
        .service-types {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 10px;
            margin-top: 0.5rem;
        }
        
        .service-option {
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            background: white;
        }
        
        .service-option.selected {
            border-color: #1e3c72;
            background: #e8f0ff;
        }
        
        .service-name {
            font-size: 1.3rem;
            font-weight: bold;
            color: #1e3c72;
            margin-bottom: 5px;
        }
        
        .service-desc {
            font-size: 0.8rem;
            color: #666;
        }
        
        .file-upload {
            border: 2px dashed #e1e5e9;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
        }
        
        .file-upload:hover {
            border-color: #1e3c72;
        }
        
        .file-upload.has-file {
            border-color: #27ae60;
            background: #e8f5e8;
        }
        
        .file-upload-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #666;
        }
        
        .file-name {
            font-size: 0.9rem;
            color: #27ae60;
            margin-top: 0.5rem;
            font-weight: 600;
        }
        
        .required-text {
            font-size: 0.8rem;
            color: #e74c3c;
            margin-top: 0.5rem;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #27ae60 0%, #219653 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
        }
        
        .btn-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.3);
        }
        
        .btn-back {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-bottom: 1rem;
            transition: background 0.3s;
        }
        
        .btn-back:hover {
            background: #5a6268;
        }
        
        .login-container {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            max-width: 400px;
            margin: 2rem auto;
        }
        
        .login-info {
            background: #e8f5e8;
            border: 1px solid #27ae60;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            text-align: center;
            font-size: 0.9rem;
            color: #2d5a27;
        }
        
        .login-actions {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 1rem;
        }
        
        footer {
            background: #2c3e50;
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 3rem;
        }
        
        .footer-content {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .contact-info {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .emergency-contact {
            background: #e74c3c;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-weight: 600;
            display: inline-block;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 10px;
                text-align: center;
            }
            
            .login-actions {
                flex-direction: column;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .logo {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        .screen {
            display: none;
        }
        
        .screen.active {
            display: block;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 10px;
            color: #666;
        }
        
        .loading.active {
            display: block;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <div class="logo-badge">PMO</div>
                    <div>
                        <div class="logo-text">Sistema de Emerg√™ncias</div>
                        <div class="municipio">Prefeitura Municipal de Ourinhos</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <div id="home" class="screen active">
        <div class="container">
            <div class="main-content">
                <div class="welcome-card">
                    <h1>Relatos de √Årvores e Emerg√™ncias</h1>
                    <p>Utilize este sistema para reportar √°rvores ca√≠das ou com risco de queda em vias p√∫blicas. Sua colabora√ß√£o ajuda a manter nossa cidade segura.</p>
                </div>
                
                <div class="button-container">
                    <button class="btn btn-report" onclick="showScreen('report')">
                        <div class="btn-icon">üìã</div>
                        <div>Fazer Relato</div>
                    </button>
                    
                    <button class="btn btn-login" onclick="showScreen('login')">
                        <div class="btn-icon">üë•</div>
                        <div>Acesso Funcion√°rios</div>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="report" class="screen">
        <div class="container">
            <div class="main-content">
                <button class="btn-back" onclick="showScreen('home')">‚Üê Voltar para o In√≠cio</button>
                <div class="form-container">
                    <h2 class="form-title">Relatar Problema com √Årvore</h2>
                    <form id="reportForm">
                        <div class="form-group">
                            <label class="form-label">Localiza√ß√£o</label>
                            <select class="form-select" id="bairro" required>
                                <option value="">Carregando bairros...</option>
                            </select>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">CEP</label>
                                <input type="text" class="form-input" id="cep" placeholder="00000-000" 
                                       maxlength="9" oninput="formatarCEP(this)">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">N√∫mero</label>
                                <input type="text" class="form-input" id="numero" placeholder="N√∫mero ou SN">
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Rua/Avenida</label>
                            <input type="text" class="form-input" id="rua" placeholder="Nome da rua" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Complemento</label>
                            <input type="text" class="form-input" id="complemento" 
                                   placeholder="Apartamento, bloco, etc.">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Ponto de Refer√™ncia</label>
                            <input type="text" class="form-input" id="referencia" placeholder="Ex: Pr√≥ximo ao mercado, em frente √† escola">
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">N√≠vel de Emerg√™ncia</label>
                            <div class="emergency-levels">
                                <div class="level-option level-3" data-level="3">
                                    <div class="level-number">3</div>
                                    <div class="level-desc">Urgente<br>(Pessoas em risco)</div>
                                </div>
                                <div class="level-option level-2" data-level="2">
                                    <div class="level-number">2</div>
                                    <div class="level-desc">Alta<br>(Atrapalha via)</div>
                                </div>
                                <div class="level-option level-1" data-level="1">
                                    <div class="level-number">1</div>
                                    <div class="level-desc">M√©dia<br>(√Årea movimentada)</div>
                                </div>
                                <div class="level-option level-0" data-level="0">
                                    <div class="level-number">0</div>
                                    <div class="level-desc">Baixa<br>(Sem urg√™ncia)</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Tipo de Servi√ßo Necess√°rio</label>
                            <div class="service-types">
                                <div class="service-option" data-service="corte_arvore">
                                    <div class="service-name">Corte</div>
                                    <div class="service-desc">Supress√£o de √Årvore</div>
                                </div>
                                <div class="service-option" data-service="poda">
                                    <div class="service-name">Poda</div>
                                    <div class="service-desc">Corte de Galhos</div>
                                </div>
                                <div class="service-option" data-service="recolher_galhos">
                                    <div class="service-name">Recolher</div>
                                    <div class="service-desc">Galhos no Ch√£o</div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Descri√ß√£o do Problema</label>
                            <textarea class="form-textarea" id="descricao" placeholder="Descreva brevemente a situa√ß√£o..." required></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Foto do Local</label>
                            <div class="file-upload" id="fileUpload">
                                <div class="file-upload-icon">üì∑</div>
                                <div>Clique para adicionar foto</div>
                                <div class="required-text">* Obrigat√≥rio - A foto √© necess√°ria para an√°lise</div>
                            </div>
                            <input type="file" id="fileInput" accept="image/*" style="display: none;">
                        </div>
                        
                        <div class="loading" id="formLoading">Enviando relato...</div>
                        
                        <button type="submit" class="btn-submit">Enviar Relato</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="login" class="screen">
        <div class="container">
            <div class="main-content">
                <button class="btn-back" onclick="showScreen('home')">‚Üê Voltar para o In√≠cio</button>
                <div class="login-container">
                    <h2 class="form-title">Acesso ao Sistema</h2>
                    <div class="login-info">
                        Acesso para gerentes, motoristas e funcion√°rios da prefeitura
                    </div>
                    <form id="loginForm">
                        <div class="form-group">
                            <label class="form-label">E-mail</label>
                            <input type="email" class="form-input" id="loginEmail" placeholder="seu.email@ourinhos.sp.gov.br" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Senha</label>
                            <input type="password" class="form-input" id="loginSenha" placeholder="Sua senha" required>
                        </div>
                        
                        <div class="login-actions">
                            <button type="button" class="btn-back" onclick="showScreen('home')">Voltar</button>
                            <button type="submit" class="btn-submit">Entrar</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="contact-info">
                    <p>Secretaria Municipal do Meio Ambiente</p>
                    <p>Hor√°rio de atendimento: Segunda a Sexta, 8h √†s 17h</p>
                </div>
                <div class="emergency-contact">
                    Emerg√™ncias: 199 | Defesa Civil: 199 | Pol√≠cia Militar: 190 | Pol√≠cia Federal Rodovi√°ria: 191 | Ambul√¢ncia: 192 | Bombeiros: 193 | Pol√≠cia Civil: 197

                </div>
                <div class="contact-info">
                    <p>¬© 2025 Prefeitura Municipal de Ourinhos - Todos os direitos reservados</p>
                </div>
            </div>
        </div>
    </footer>

<script>
let selectedFile = null;
let selectedLevel = null;
let selectedService = null;

// Dados reais dos bairros de Ourinhos
const BAIRROS_REAIS = [
    { id: 1, nome: "Centro" },
    { id: 2, nome: "Vila Brasil" },
    { id: 3, nome: "Vila Moraes" },
    { id: 4, nome: "Jardim Matilde" },
    { id: 5, nome: "Jardim Santa F√©" },
    { id: 6, nome: "Jardim das Oliveiras" },
    { id: 7, nome: "Jardim Europa" },
    { id: 8, nome: "Jardim Ouro Verde" },
    { id: 9, nome: "Jardim Paulista" },
    { id: 10, nome: "Jardim Princesa" },
    { id: 11, nome: "Jardim Santa Clara" },
    { id: 12, nome: "Jardim S√£o Lucas" },
    { id: 13, nome: "Conjunto Habitacional Deputado Eduardo Sadao Ito" },
    { id: 14, nome: "Jardim das Rosas" },
    { id: 15, nome: "Jardim Fl√≥rida" },
    { id: 16, nome: "Jardim Itamarati" },
    { id: 17, nome: "Jardim Novo Itamarati" },
    { id: 18, nome: "Jardim Santos Dumont" },
    { id: 19, nome: "Jardim Silvana" },
    { id: 20, nome: "Jardim das Azal√©ias" },
    { id: 21, nome: "Jardim das Flores" },
    { id: 22, nome: "Jardim das Palmeiras" },
    { id: 23, nome: "Jardim Estoril" },
    { id: 24, nome: "Jardim Maria Luiza" },
    { id: 25, nome: "Jardim Maria Luiza IV" },
    { id: 26, nome: "Jardim M√¥naco" },
    { id: 27, nome: "Jardim Oasis" },
    { id: 28, nome: "Jardim Ouro Branco" },
    { id: 29, nome: "Jardim Panorama" },
    { id: 30, nome: "Jardim Santa Maria" },
    { id: 31, nome: "Jardim Santiago" },
    { id: 32, nome: "Jardim S√£o Jorge" },
    { id: 33, nome: "Jardim S√£o Jos√©" },
    { id: 34, nome: "Jardim Tangar√°" },
    { id: 35, nome: "Jardim das Na√ß√µes" },
    { id: 36, nome: "Jardim das Orqu√≠deas" },
    { id: 37, nome: "Jardim Dona Evangelina" },
    { id: 38, nome: "Jardim dos Girass√≥is" },
    { id: 39, nome: "Jardim Altos da Cidade" },
    { id: 40, nome: "Jardim Alvorada" },
    { id: 41, nome: "Jardim Am√©rica" },
    { id: 42, nome: "Jardim Bandeirantes" },
    { id: 43, nome: "Jardim Bela Vista" },
    { id: 44, nome: "Jardim Brasil" },
    { id: 45, nome: "Jardim Calif√≥rnia" },
    { id: 46, nome: "Jardim Canad√°" },
    { id: 47, nome: "Jardim Colina" },
    { id: 48, nome: "Jardim das Paineiras" },
    { id: 49, nome: "Jardim das Tulipas" },
    { id: 50, nome: "Jardim Europa" },
    { id: 51, nome: "Jardim Guaiap√≥" },
    { id: 52, nome: "Jardim Gua√≠ra" },
    { id: 53, nome: "Jardim Icarai" },
    { id: 54, nome: "Jardim Ipanema" },
    { id: 55, nome: "Jardim Itaipu" },
    { id: 56, nome: "Jardim Marab√°" },
    { id: 57, nome: "Jardim Maring√°" },
    { id: 58, nome: "Jardim Maristela" },
    { id: 59, nome: "Jardim Novo Mundo" },
    { id: 60, nome: "Jardim Oasis" },
    { id: 61, nome: "Jardim Ouro Verde" },
    { id: 62, nome: "Jardim Paran√°" },
    { id: 63, nome: "Jardim Paulista" },
    { id: 64, nome: "Jardim Planalto" },
    { id: 65, nome: "Jardim Primavera" },
    { id: 66, nome: "Jardim Real" },
    { id: 67, nome: "Jardim Santa M√¥nica" },
    { id: 68, nome: "Jardim Santo Ant√¥nio" },
    { id: 69, nome: "Jardim S√£o Domingos" },
    { id: 70, nome: "Jardim S√£o Francisco" },
    { id: 71, nome: "Jardim S√£o Luiz" },
    { id: 72, nome: "Jardim Tropical" },
    { id: 73, nome: "Jardim Universal" },
    { id: 74, nome: "Jardim Vale Verde" },
    { id: 75, nome: "Jardim Virg√≠nia" },
    { id: 76, nome: "Parque Minas Gerais" },
    { id: 77, nome: "Vila Boa Esperan√ßa" },
    { id: 78, nome: "Vila Industrial" },
    { id: 79, nome: "Vila Perino" },
    { id: 80, nome: "Jardim dos Ip√™s" },
    { id: 81, nome: "Jardim Santa Catarina" },
    { id: 82, nome: "Jardim Santa Rosa" },
    { id: 83, nome: "Jardim S√£o Carlos" },
    { id: 84, nome: "Jardim S√£o Jo√£o" },
    { id: 85, nome: "Jardim Vit√≥ria" },
    { id: 86, nome: "Conjunto Habitacional Jo√£o Turquino" },
    { id: 87, nome: "Jardim Alvorada" },
    { id: 88, nome: "Jardim Am√©rica" },
    { id: 89, nome: "Jardim Bandeirantes" },
    { id: 90, nome: "Jardim Bela Vista" },
    { id: 91, nome: "Jardim Bras√≠lia" },
    { id: 92, nome: "Jardim Calif√≥rnia" },
    { id: 93, nome: "Jardim Canad√°" },
    { id: 94, nome: "Jardim das Flores" },
    { id: 95, nome: "Jardim das Na√ß√µes" },
    { id: 96, nome: "Jardim das Oliveiras" },
    { id: 97, nome: "Jardim Europa" },
    { id: 98, nome: "Jardim Fl√≥rida" },
    { id: 99, nome: "Jardim Ipiranga" },
    { id: 100, nome: "Jardim Itaipu" },
    { id: 101, nome: "Jardim Marab√°" },
    { id: 102, nome: "Jardim Maring√°" },
    { id: 103, nome: "Jardim Novo Mundo" },
    { id: 104, nome: "Jardim Oasis" },
    { id: 105, nome: "Jardim Ouro Verde" },
    { id: 106, nome: "Jardim Panorama" },
    { id: 107, nome: "Jardim Paulista" },
    { id: 108, nome: "Jardim Planalto" },
    { id: 109, nome: "Jardim Primavera" },
    { id: 110, nome: "Jardim Real" },
    { id: 111, nome: "Jardim Santa F√©" },
    { id: 112, nome: "Jardim Santa M√¥nica" },
    { id: 113, nome: "Jardim Santo Ant√¥nio" },
    { id: 114, nome: "Jardim S√£o Domingos" },
    { id: 115, nome: "Jardim S√£o Francisco" },
    { id: 116, nome: "Jardim S√£o Luiz" },
    { id: 117, nome: "Jardim Tropical" },
    { id: 118, nome: "Jardim Universal" },
    { id: 119, nome: "Jardim Virg√≠nia" },
    { id: 120, nome: "Parque Valeriano" },
    { id: 121, nome: "Vila Aparecida" },
    { id: 122, nome: "Vila Oper√°ria" },
    { id: 123, nome: "Centro" },
    { id: 124, nome: "Vila Industrial" },
    { id: 125, nome: "Jardim Europa" },
    { id: 126, nome: "Parque Minas Gerais" },
    { id: 127, nome: "Jardim Santa F√©" },
    { id: 128, nome: "Vila Odilon" },
    { id: 129, nome: "Jardim das Oliveiras" },
    { id: 130, nome: "Conjunto Habitacional Ana Jacinta" },
    { id: 131, nome: "Jardim Ouro Verde" },
    { id: 132, nome: "Vila Brasil" },
    { id: 133, nome: "Jardim Paulista" },
    { id: 134, nome: "Parque S√£o Jorge" },
    { id: 135, nome: "Vila Perino" },
    { id: 136, nome: "Jardim das Rosas" },
    { id: 137, nome: "Conjunto Habitacional Doutor Antonio R. de Lima" }
];

// Fun√ß√£o para mostrar/ocultar telas
function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
    });
    document.getElementById(screenId).classList.add('active');
    
    if (screenId === 'report') {
        carregarDadosFormulario();
    }
}

// Carregar dados do formul√°rio
function carregarDadosFormulario() {
    console.log('Carregando bairros...');
    
    // Preencher select de bairros
    const selectBairro = document.getElementById('bairro');
    selectBairro.innerHTML = '<option value="">Selecione o bairro</option>';
    
    BAIRROS_REAIS.forEach(bairro => {
        const option = document.createElement('option');
        option.value = bairro.id;
        option.textContent = bairro.nome;
        selectBairro.appendChild(option);
    });

    console.log('Bairros carregados com sucesso');
}

// Formatar CEP
function formatarCEP(input) {
    let cep = input.value.replace(/\D/g, '');
    if (cep.length > 5) {
        cep = cep.substring(0, 5) + '-' + cep.substring(5, 8);
    }
    input.value = cep;
    
    // Buscar endere√ßo automaticamente quando CEP estiver completo
    if (cep.length === 9) {
        buscarEnderecoPorCEP(cep);
    }
}

// Buscar endere√ßo por CEP
async function buscarEnderecoPorCEP(cep) {
    try {
        const cepLimpo = cep.replace(/\D/g, '');
        if (cepLimpo.length === 8) {
            const resposta = await fetch(`https://viacep.com.br/ws/${cepLimpo}/json/`);
            const endereco = await resposta.json();
            
            if (!endereco.erro) {
                document.getElementById('rua').value = endereco.logradouro || '';
                
                // Tentar encontrar bairro correspondente
                const selectBairro = document.getElementById('bairro');
                const bairroDigitado = endereco.bairro.toLowerCase();
                
                for (let option of selectBairro.options) {
                    if (option.text.toLowerCase().includes(bairroDigitado)) {
                        option.selected = true;
                        break;
                    }
                }
            }
        }
    } catch (error) {
        console.error('Erro ao buscar CEP:', error);
    }
}

// Selecionar n√≠vel de emerg√™ncia
function selectLevel(level) {
    selectedLevel = level;
    
    document.querySelectorAll('.level-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    const selectedOption = document.querySelector(`.level-option[data-level="${level}"]`);
    if (selectedOption) {
        selectedOption.classList.add('selected');
    }
}

// Selecionar tipo de servi√ßo
function selectService(serviceType) {
    selectedService = serviceType;
    
    document.querySelectorAll('.service-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    const selectedOption = document.querySelector(`.service-option[data-service="${serviceType}"]`);
    if (selectedOption) {
        selectedOption.classList.add('selected');
    }
}

// Manipula√ß√£o de arquivos
function handleFileSelect(input) {
    if (input.files && input.files[0]) {
        selectedFile = input.files[0];
        const fileUpload = document.getElementById('fileUpload');
        fileUpload.classList.add('has-file');
        fileUpload.innerHTML = `
            <div class="file-upload-icon">‚úÖ</div>
            <div>Arquivo selecionado</div>
            <div class="file-name">${selectedFile.name}</div>
            <div class="required-text">* Obrigat√≥rio - A foto √© necess√°ria para an√°lise</div>
        `;
    }
}

// Resetar formul√°rio
function resetarFormulario() {
    document.getElementById('reportForm').reset();
    selectedLevel = null;
    selectedService = null;
    selectedFile = null;
    
    document.querySelectorAll('.level-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    document.querySelectorAll('.service-option').forEach(option => {
        option.classList.remove('selected');
    });
    
    document.getElementById('fileUpload').innerHTML = `
        <div class="file-upload-icon">üì∑</div>
        <div>Clique para adicionar foto</div>
        <div class="required-text">* Obrigat√≥rio - A foto √© necess√°ria para an√°lise</div>
    `;
    document.getElementById('fileUpload').classList.remove('has-file');
}

// ===== FUN√á√ïES DE LOCALIZA√á√ÉO =====

// Verificar e obter localiza√ß√£o do usu√°rio
async function obterLocalizacaoUsuario() {
    return new Promise((resolve, reject) => {
        if (!navigator.geolocation) {
            reject(new Error('Geolocaliza√ß√£o n√£o suportada pelo navegador'));
            return;
        }

        navigator.geolocation.getCurrentPosition(
            (position) => {
                resolve({
                    latitude: position.coords.latitude,
                    longitude: position.coords.longitude,
                    precisao: position.coords.accuracy
                });
            },
            (error) => {
                let mensagemErro;
                switch(error.code) {
                    case error.PERMISSION_DENIED:
                        mensagemErro = "Permiss√£o de localiza√ß√£o negada. Por favor, permita o acesso √† localiza√ß√£o.";
                        break;
                    case error.POSITION_UNAVAILABLE:
                        mensagemErro = "Localiza√ß√£o indispon√≠vel.";
                        break;
                    case error.TIMEOUT:
                        mensagemErro = "Tempo limite para obter localiza√ß√£o.";
                        break;
                    default:
                        mensagemErro = "Erro desconhecido ao obter localiza√ß√£o.";
                }
                reject(new Error(mensagemErro));
            },
            {
                enableHighAccuracy: true,
                timeout: 10000,
                maximumAge: 60000
            }
        );
    });
}

// Validar se o usu√°rio est√° pr√≥ximo do local relatado
function validarProximidade(latUsuario, lonUsuario, latRelato, lonRelato) {
    // Raio da Terra em metros
    const R = 6371000;
    
    // Converter graus para radianos
    const lat1 = latUsuario * Math.PI / 180;
    const lat2 = latRelato * Math.PI / 180;
    const deltaLat = (latRelato - latUsuario) * Math.PI / 180;
    const deltaLon = (lonRelato - lonUsuario) * Math.PI / 180;

    // F√≥rmula de Haversine
    const a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2) +
              Math.cos(lat1) * Math.cos(lat2) *
              Math.sin(deltaLon/2) * Math.sin(deltaLon/2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    const distancia = R * c;

    return {
        distancia: distancia,
        estaProximo: distancia <= 500 // 500 metros de toler√¢ncia
    };
}

// Buscar coordenadas do endere√ßo (geocoding)
async function buscarCoordenadasEndereco(endereco, numero, bairro, cidade = "Ourinhos") {
    try {
        const enderecoCompleto = `${endereco}, ${numero}, ${bairro}, ${cidade}, SP`;
        const resposta = await fetch(
            `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(enderecoCompleto)}&limit=1`
        );
        
        const dados = await resposta.json();
        
        if (dados && dados.length > 0) {
            return {
                latitude: parseFloat(dados[0].lat),
                longitude: parseFloat(dados[0].lon),
                confianca: 0.8 // Confian√ßa m√©dia do geocoding
            };
        }
        
        throw new Error('Endere√ßo n√£o encontrado');
    } catch (error) {
        console.error('Erro no geocoding:', error);
        return null;
    }
}

// Event Listeners
document.addEventListener('DOMContentLoaded', function() {
    // N√≠veis de emerg√™ncia
    document.querySelectorAll('.level-option').forEach(option => {
        option.addEventListener('click', function() {
            const level = parseInt(this.getAttribute('data-level'));
            selectLevel(level);
        });
    });

    // Tipos de servi√ßo
    document.querySelectorAll('.service-option').forEach(option => {
        option.addEventListener('click', function() {
            const serviceType = this.getAttribute('data-service');
            selectService(serviceType);
        });
    });

    // Upload de arquivo
    document.getElementById('fileUpload').addEventListener('click', function() {
        document.getElementById('fileInput').click();
    });

    document.getElementById('fileInput').addEventListener('change', function() {
        handleFileSelect(this);
    });

    // CEP - buscar endere√ßo quando perder foco
    document.getElementById('cep').addEventListener('blur', function() {
        buscarEnderecoPorCEP(this.value);
    });
});

// Formul√°rio de Relatos - VERS√ÉO SIMPLIFICADA
document.getElementById('reportForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    // Valida√ß√µes b√°sicas
    if (!selectedFile) {
        alert('Por favor, selecione uma foto do local.');
        return false;
    }
    
    if (!selectedLevel) {
        alert('Por favor, selecione o n√≠vel de emerg√™ncia.');
        return false;
    }

    if (!selectedService) {
        alert('Por favor, selecione o tipo de servi√ßo necess√°rio.');
        return false;
    }

    const bairroSelect = document.getElementById('bairro');
    const rua = document.getElementById('rua').value;
    const numero = document.getElementById('numero').value;
    
    if (!bairroSelect.value) {
        alert('Por favor, selecione um bairro.');
        return false;
    }

    if (!rua) {
        alert('Por favor, informe a rua.');
        return false;
    }

    // Mostrar loading
    document.getElementById('formLoading').classList.add('active');

    try {
        // Simular processamento
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Buscar nome do bairro selecionado
        const bairroNome = bairroSelect.options[bairroSelect.selectedIndex].text;
        
        // Gerar protocolo
        const protocolo = Math.floor(1000 + Math.random() * 9000);
        
        // Mostrar resumo do relato
        const mensagem = `
Relato enviado com sucesso!

üìã Protocolo: #${protocolo}
üìç Local: ${rua}, ${numero || 'SN'} - ${bairroNome}
üîß Servi√ßo: ${selectedService === 'corte_arvore' ? 'Corte de √Årvore' : 
              selectedService === 'poda' ? 'Poda de Galhos' : 'Recolhimento de Galhos'}
üö® Emerg√™ncia: N√≠vel ${selectedLevel}

O relato foi registrado e ser√° analisado pela equipe t√©cnica.
        `.trim();
        
        alert(mensagem);
        
        showScreen('home');
        resetarFormulario();
        
    } catch (error) {
        console.error('Erro:', error);
        alert('Erro ao processar relato: ' + error.message);
    } finally {
        document.getElementById('formLoading').classList.remove('active');
    }
    
    return false;
});

// LOGIN - Vers√£o simplificada
document.getElementById('loginForm').addEventListener('submit', async function(e) {
    e.preventDefault();

    const email = document.getElementById('loginEmail').value;
    const senha = document.getElementById('loginSenha').value;

    if (!email || !senha) {
        alert('Por favor, preencha todos os campos.');
        return;
    }

    // Mostrar loading
    const submitBtn = this.querySelector('button[type="submit"]');
    const originalText = submitBtn.textContent;
    submitBtn.textContent = 'Entrando...';
    submitBtn.disabled = true;

    try {
        // Simular processo de login
        await new Promise(resolve => setTimeout(resolve, 2000));
        
        // Verificar credenciais padr√£o do banco
        const usuarios = [
            { email: 'admin@ourinhos.sp.gov.br', senha: 'password', tipo: 'admin', nome: 'Administrador' },
            { email: 'motorista@ourinhos.sp.gov.br', senha: 'password', tipo: 'motorista', nome: 'Motorista' },
            { email: 'funcionario@ourinhos.sp.gov.br', senha: 'password', tipo: 'funcionario', nome: 'Funcion√°rio' }
        ];
        
        const usuario = usuarios.find(u => u.email === email && u.senha === 'password');
        
        if (usuario) {
            alert(`Login bem-sucedido! Bem-vindo, ${usuario.nome}`);
            
            // Redirecionar baseado no tipo de usu√°rio (simulado)
            switch(usuario.tipo) {
                case 'admin':
                    window.location.href = "admindashboard.php";
                    break;
                case 'motorista':
                    window.location.href = "motoristadashboard.php";
                    break;
                case 'funcionario':
                    window.location.href = "funcionariodashboard.php";
                    break;
                default:
                    alert('Tipo de usu√°rio n√£o reconhecido');
            }
        } else {
            alert('E-mail ou senha incorretos. Use: admin@ourinhos.sp.gov.br / password');
        }
    } catch (error) {
        console.error("Erro no login:", error);
        alert("Erro de conex√£o. Tente novamente.");
    } finally {
        submitBtn.textContent = originalText;
        submitBtn.disabled = false;
    }
});

// Inicializa√ß√£o
window.addEventListener('load', function() {
    console.log('Sistema de Emerg√™ncias - Prefeitura de Ourinhos');
    console.log('Bairros carregados:', BAIRROS_REAIS.length);
});
</script>
</body>
</html>
